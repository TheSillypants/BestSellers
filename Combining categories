# Combine categories for "Trade Fiction Hardcover" and "Trade Fiction Paperback" into one category, "Trade Fiction" and combine sagas and their individual books and their rereleases

library(dplyr) 

# Read the CSV file
file_path <- "bestsellers_2_csv.csv"
df <- read.csv(file_path, stringsAsFactors = FALSE)

# Standardize list_name by combining 'Trade Fiction Hardcover' and 'Trade Fiction Paperback'
df <- df %>%
  mutate(list_name = ifelse(list_name %in% c("Trade Fiction Hardcover", "Trade Fiction Paperback"), 
                            "Trade Fiction", list_name))

# Create a column to identify sagas (assuming saga names appear in the title.) If saga information is in a separate column, use that instead
df <- df %>%
  mutate(saga = case_when(
    grepl("Harry Potter", title, ignore.case = TRUE) ~ "Harry Potter",
    grepl("Lord of the Rings", title, ignore.case = TRUE) ~ "Lord of the Rings",
    grepl("Twilight", title, ignore.case = TRUE) ~ "Twilight",
    grepl("Game of Thrones|Song of Ice and Fire", title, ignore.case = TRUE) ~ "Game of Thrones",
    TRUE ~ title  # If no saga match, keep individual book title
  ))

# Remove duplicate sage entries 
df_saga_combined <- df %>%
  arrange(saga, published_date) %>%
  distinct(saga, .keep_all = TRUE)

# Save the cleaned dataset
write.csv(df_saga_combined, "bestsellers_saga_combined.csv", row.names = FALSE)

# Print the first few rows
head(df_saga_combined)

# View the updated dataset
View(df_saga_combined)
